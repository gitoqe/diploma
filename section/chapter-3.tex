\section{Проектирование web-ресурса для учебного центра}

На основании технологий и требований, выделенных в главах 1 и 2 можно составить краткий план выполнения практической части работы.
Необходимо обеспечить процесс разработки документацией и планами вносимых изменений.

В первую очередь необходимо подготовить схему планируемой функциональной структуры ресурса.
На основании данной схемы будут строится взаимосвязи между программными решениями, используемыми для разработки и дальнейшей работы сайта.

Следующий этап -- формирование структурной схемы веб-ресурса.
В её задачи будет входить упрощенное описание компонентов-страниц сайта, расположение и отношение между ними.
Этот шаг позволит с пониманием общей картины подходить к разработке отдельных частей ресурса.

Следующим важным решением будет выделение ключевых сущностей для хранения в базе данных, их взаимоотношения и зависимостей.
На основе этих данных будут строится отдельные компоненты страниц веб-ресурса с использованием шаблонов.


\subsection{Функциональная структура ресурса}

Исходя из определенных для использования в главах 1 и 2 программных средств, можно составить функциональную структуру ресурса.
Она призвана отобразить основные элементы системы, обеспечивающие работу элементов сайта, а также взаимосвязи между ними.

Выбранными элементами стека MEAN с внесёнными правками являются -- SQLite в роли СУБД, Express и Node.js для организации серверной части приложения, Angular для работы с клиентской частью.
Также стоит упомянуть CSS-библиотеку Bulma, которая также будет задействована в данной работе.
На основе приведенных программных средств составлена схема функциональных элементов на рисунке \ref{func-struct-scheme}.

\addimghere{images/diagrams/функциональная-структура.png}{0.5}{Функциональная структура веб-ресурса}{func-struct-scheme}


\subsection{Анализ структуры исходного ресурса}\label{Анализ структуры исходного ресурса}

Главная страница исходного сайта содержит 4 основных раздела -- «Главная», «Сведения об организации», «Обучение», «Аренда».
Также здесь расположены различные вспомогательные ссылки, реализующие переходы на некоторые ключевые разделы ресурса.
Схема основных переходов внутри главной страницы отображена на рисунке \ref{meson-old-main}.

\addimghere{images/diagrams/главная.png}{1}{Схема строения переходов исходного веб-ресурса}{meson-old-main}

В схеме на рисунке \ref{meson-old-main} отметкой <<(неактуально)>> помечены переходы на неактуальные страницы, которые по разным причинам либо давно не обновлялись, либо отсутствуют вовсе.
При этом основными функциональными элементами на главной странице являются ссылки «Расписание», «Стоимость» и «Брошюра».
Взаимодействие с данными, представленными на целевых страницах этих ссылок содержит самую полезную информацию, которая может потребоваться для клиентов учреждения.
Помимо этого, контент этих элементов частично дублируется и частично взаимно противоречит.

Раздел «Сведения об организации» содержит наибольшее количество вложенных страниц - «Основные сведения», «Документы», «Образование», «Образовательные стандарты», «Руководство и педагогический состав», «Структура и органы управления», «Материально-техническое обеспечение и оснащенность образовательного процесса», «Стипендии и иные виды материальной поддержки», «Платные образовательные услуги», «Финансово-хозяйственная деятельность», «Вакантные места для приема (перевода)».
Большая часть содержимого этих подразделов либо дублируется в других частях ресурса, либо является вовсе неактуальной.

Раздел «Обучение» состоит из страниц «Компьютерная школа», «Лаборатории инновационного творчества», «Школа личностного роста», «ИТ-курсы для взрослых».
Содержимое этих частей ресурса по большей части устарело и является неактуальным.

Раздел «Аренда» содержит информацию об аренде помещений учебного центра.
Часть информации данной страницы является неактуальной.
Подразделы здесь отсутствуют.

Помимо переходов на обозначенные разделы со страницы «Главная», также есть необозначенные там три -- «Независимая оценка качества», «Противодействие коррупции», «Инклюзивное образование».
Состав этих элементов также является частично неактуальным.

% // TODO sitemapmaker - карта переходов исходного сайта

Из вышеописанных фактов можно сделать вывод о заброшенности большинства разделов сайта.
Часть этих страниц можно актуализировать и восстановить в новой версии, а часть объединить с другими.


\subsection{Структура проектируемого ресурса}

На основе проведенного в подпункте \ref{Анализ структуры исходного ресурса} анализа можно выделить ключевые разделы проектируемого веб-ресурса с учетом объединения и перестановки исходных.
В результате получатся следующие пункты: «Поступление», «Курсы», «Расписание», «Работы учеников», «Об организации», «Оплата и аренда».

Раздел «Поступление» рассказывает пользователю о правилах записи на курсы учебного центра.

Раздел «Курсы» представляет клиенту набор имеющихся для проведения курсов обучения с возможностью подробного рассмотрения особенностей каждого из них в отдельности.

Раздел «Расписание» включает в себя расписание занятий групп на учебный год, позволяет оперативно сориентировать клиентов касательно выходных дней в организации.

Раздел «Работы учеников» представляет клиентам возможность ознакомиться с выставленными работами студентов разных направлений.

Раздел «Об организации» содержит информацию о компании, руководстве, а также обширный набор вспомогательной документации, полезной для ознакомления.

Раздел «Оплата и аренда» содержит информацию о способах оплаты услуг учебного центра и предоставляемых в аренду помещениях.

Также стоит отметить точку входа на сайт -- раздел «Главная», встречающий пользователя.
Здесь описываются функциональные модули-страницы сайта и их содержимое, а также основные данные об учебном центре.

На основании приведенных разделов можно сформировать структурную схему веб-ресурса, отображающую получившуюся иерархию страниц.
Результат формирования такой структуры представлен на Рисунке \ref{struct-scheme}.

\addimghere{images/diagrams/структура-ресурса.png}{1}{Структурная схема проектируемого веб-ресурса}{struct-scheme}

Упрощение базовой структуры облегчит взаимодействие с информацией на сайте.
Также будет проще пользоваться ресурсом на мобильных устройствах.


\subsection{Выделение основных сущностей и построение полной атрибутивной модели данных}\label{Выделение основных сущностей и построение полной атрибутивной модели данных}

В работе любой системы задействуются данные.
Их можно классифицировать по различным признакам, на основе которых можно выделить общий набор характеристик и хранить их в единообразном хранилище -- базе данных.

Для разрабатываемого ресурса будут задействованы возможности СУБД SQLite.
Важно учитывать особенность данной СУБД -- наличие ограниченного списка базовых типов данных.
В него входят NULL для пустых значений, INTEGER для целочисленных значений разного размера с учетом знака, REAL для хранения вещественных значений, TEXT для хранения строк, BLOB для хранения двоичных объектов.
Среди имеющегося на исходном сайте контента можно выделить несколько сущностей, доступных для переноса в формат базы данных.

Первая таблица -- <<Courses>>.
Предназначен для хранения информации о конкретном курсе.
В общие характеристики-поля можно выделить имя, описание, стоимость, тип оплаты -- за месяц или занятие, прямое продолжение курса, уровень курса -- дошкольный или школьный, класс или возраст в зависимости от уровня курса, длительность занятия, список тем.
Схема данной таблицы представлена на рисунке \ref{uml-courses}.
\addimghere{images/uml/uml-courses.png}{0.35}{Схема таблицы <<Courses>>}{uml-courses}

Вторая таблица -- <<Levels>>
Это вспомогательная таблица содержит поле для выбора в таблице <<Courses>> -- наименование уровня.
Схема данной таблицы представлена на рисунке \ref{uml-levels}.
\addimghere{images/uml/uml-levels.png}{0.35}{Схема таблицы <<Levels>>}{uml-levels}

Третья таблица -- <<Students\_work>>.
Эта таблица будет хранить данные для представления на странице итоговых работ студентов с разных курсов.
Для её работы потребуются следующие поля -- соответствующий курс, опциональное имя студента, год выполнения работы, ссылка на работу.
Схема данной таблицы представлена на рисунке \ref{uml-students_work}.
\addimghere{images/uml/uml-students_work.png}{0.35}{Схема таблицы <<Students\_work>>}{uml-students_work}

Четвертая таблица -- <<Employees>>.
Сюда можно отнести данны о преподавательском составе.
Выделяемые поля -- фамилия, имя, отчество, должность, образование, год начала работы, педагогический стаж.
Схема данной таблицы представлена на рисунке \ref{uml-employees}.
\addimghere{images/uml/uml-employees.png}{0.35}{Схема таблицы <<Employees>>}{uml-employees}

На данном этапе возникает необходимость в перечислении нескольких значений в составе одной ячейки.
Можно выполнить такую задачу через применение связующей таблицы, где будут перечислены соотношения между записями отдельных таблиц.

Пятая таблица -- <<Teaches>>.
Данная таблица -- связующая между таблицами <<Employees>> и <<Courses>>.
В её задачи входит перечисление соответствий сотрудников преподаваемым ими курсам.
Схема данной таблицы представлена на рисунке \ref{uml-teaches}.
\addimghere{images/uml/uml-teaches.png}{0.35}{Схема таблицы <<Teaches>>}{uml-teaches}

Итоговый вид базы данных с таблицами, используемыми в формировании наполнения веб-ресурса представлен на рисунке \ref{uml-final}.
\addimghere{images/uml/uml-final.png}{0.6}{Структура таблиц базы данных, участвующих в формировании содержимого веб-ресурса}{uml-final}

Помимо использования контента, расположенного в базе данных, веб-ресурсу также требуется возможность редактирования исходной информации.
Для таких задач может подойти и обычные программные средства СУБД, так и решения встроенные непосредственно в сайт.

Осуществление данной задачи потребует контроля доступа к функционалу редактирования.
Вместе с этим возникает необходимость хранения данных для его активации.
Для этой задачи можно воспользоваться отдельной таблицей для записи пар логинов и паролей пользователей, обладающих правами редактора содержимого веб-ресурса.

В реализации подходящей таблицы должно быть несколько обязательных полей.
В них входят -- логин пользователя, пароль пользователя, уникальный идентификатор, а также вспомогательный уникальный токен для использования в процессе авторизации.
Схема данной таблицы представлена на рисунке \ref{uml-users}.
\addimghere{images/uml/uml-users.png}{0.35}{Структура таблицы <<Users>>}{uml-users}

На основании представленных схем таблиц базы данных, а также описания полей в них содержащихся, можно сформировать общую картину приложения с точки зрения хранимой информации.
При этом важно учесть сущности, атрибуты и связи.

Указанные в формируемой схеме типы будут соответствовать применяемым в SQLite -- INTEGER, BLOB, TEXT и FLOAT соответственно.
Внешние ключи помечены как сокращение от <<foreign key>> -- <<FK>>, а первичный ключ от <<primary key>> -- <<PK>>.
За данную задачу отвечает полная атрибутивная модель данных, показанная на рисунке \ref{uml-attr-model}.
\addimghere{images/uml/uml-attr-model.png}{0.7}{Полная атрибутивная модель данных проектируемого веб-ресурса}{uml-attr-model}

Исходя из обозначенных в главе 2 задач, а также проведенного анализа и проектирования в данной главе можно переходить к процессу непосредственной разработки элементов веб-ресурса, основываясь на полученных диаграммах, схемах и выводах.


\subsection{Создание и наполнение базы данных}

Для формирования контента разделов веб-ресурса можно воспользоваться отдельными шаблонами для каждой страницы, но в таком случае придется создавать множество однотипных файлов.
Например, количество активно ведущихся курсов больше 20, что вынуждает при применении вышеуказанного подхода задействовать аналогичное количество однообразных документов.
Альтернативный вариант -- использование функционала Angular и применение шаблона страницы, который заполняется переданной в него информацией, извлекаемой из БД.

Для реализации такого подхода были спроектированы схемы таблиц базы данных, применяемых в шаблонах компонентов, касающихся курсов, сотрудников и работ учеников.

Процесс формирования исходного файла базы данных, а также его первоначальное наполнение будет произведено с использованием бесплатной программы SQLiteStudio \cite{sqlitestudio}.
Пример созданной и заполненной полями с выставленными свойствами таблицы <<Users>> в SQLiteStudio представлен на рисунке \ref{sqlite-users}.
\addimghere{images/sqlite-users.png}{0.9}{Таблица <<Users>> в SQLiteStudio}{sqlite-users}

Данное программное обеспечение бесплатно, русифицировано и присутствует на трех основных семействах операционных системы -- Linux, macOS и Windows.
Для работы с базой данных со стороны администратора без необходимости использования веб-интерфейса или серверного решения сайта предполагается использование именно SQLiteStudio.
% // TODO БД - почему BLOB для json

% // TODO код парсинга BLOB -> json




\subsection{Используемые программные интерфейсы взаимодействия с базой данных}

Для реализации связи между базой данных и приложением нужна программная реализация интерфейса взаимодействия или API.
В случае веб-сервиса предлагается использовать методы протокола HTTP.

Как указывалось в главе 2, одним из наиболее распространенных решений является REST архитектура построения таких механизмов.
Касательно запросов необходимо реализовать CRUD-действия над данными, а именно: Create -- создание, Read -- чтение, Update -- изменение, Delete -- удаление.
Перекладывая их на базу HTTP-методов получается использование стандартных обращений.
Метод GET -- для получения, POST -- для добавления, PUT -- для изменения, DELETE -- для удаления.

Работа такого подхода будет лежать в обращении к серверной стороне по однозначно определенному адресу URL, содержащему конкретное обозначение искомых данных.
Например, часть URL при обращении к пользователю с идентификатором 31 будет выглядеть так: <</users/31>>.

Помимо адреса, для реализации интерфейса важно учитывать и метод протокола HTTP, с которым производится обращение.
Таким образом сочетание <<GET /users/31>> можно интерпретировать за запрос на получение данных о пользователе с идентификатором 31.

Аналогично осуществляется работа и остальных запросов.
Чаще всего вся реализация укладывается в основные 5 запросов, отвечающих за следующие задачи: добавления записи, удаления записи, обновления записи, получения записи, получения всех записей данного типа.

Исходя из описанного, а также выявленных в разделе \ref{Выделение основных сущностей и построение полной атрибутивной модели данных} спецификаций таблиц можно составить требования к проектируемым программным интерфейсам.

Предварительно задачу можно описать так: необходимо реализовать по 5 HTTP-методов для взаимодействия с таблицами <<Levels>>, <<Courses>>, <<Students\_work>>, <<Employees>>, <<Teaches>>, <<Users>>.
При этом важно учитывать, что активное взаимодействие как и полная реализация интерфейсов со стороны веб-приложения потребуется лишь для некоторых таблиц.

Система запросов к программным интерфейсам называется роутингом от английского route -- путь.
Выстраивая такую коллекцию возможных путей мы реализуем доступ по ним извне серверной части веб-сервиса.

Для реализации роутинга на базе Node.js можно использовать как встроенные средства, так и пользоваться библиотеками и фреймворками.
В данной работе будет задействоваться Express.js.
С его помощью будут описаны обращения к различным роутам приложения и завязанные с этим взаимодействия с базой данных.

На рисунке \ref{code-router-get} показана реализация стандартного обращения к серверу без передачи параметров в URL.

\addimghere{images/code/code-api-get-default-route.png}{0.5}{Реализация роута для GET запроса без параметров}{code-router-get}

В данном случае задействован фреймворк Express.js, описывающий основу веб-сервера приложения.
При запросе к корневому адресу сервера будет произведен ответ с содержимым <<Server is working>>.

Для проверки работы запросов можно воспользоваться Postman \cite{postman}.
Данная программа позволяет создавать и хранить шаблоны обращений к веб-серверам с использованием различных сочетаний запросов и передаваемых данных.
Пример выполнения GET запроса к серверу без передачи параметров в URL и теле запроса через Postman представлен на рисунке \ref{postman-get-default}

\addimghere{images/postman-get-default.png}{1}{Выполнение GET запроса к серверу с использованием программы Postman}{postman-get-default}

Для реализации взаимодействия с базой данных необходимо воспользоваться библиотекой sqlite3, предоставляемой для Node.js.
Через неё реализуется подключение и обработка команд.
Процесс описания модуля взаимодействия с файлом базы данных sqlite отображен на рисунке \ref{code-api-db-handler}.

\addimghere{images/code/code-api-db-handler.png}{0.8}{Объявление и настройка подключения к файлу базы данных с использованием библиотеки sqlite3}{code-api-db-handler}

Созданный объект взаимодействия экспортируется для осуществления доступа к нему в других файлах веб-сервера.
После этого можно выстраивать запрос к базе с использованием обозначенного подключения.

Примеры построения пяти базовых методов обработки обращения к таблице <<Courses>> через HTTP запросы приведены ниже.
На рисунке \ref{code-api-example-courses-1} -- вариант настройки обработки GET запроса ко всей таблице, а на рисунке \ref{code-api-example-courses-2} -- также обработка GET, но с указанным идентификатором записи

\addimghere{images/code/code-api-example-courses-1.png}{0.8}{Обработка метода GET к таблице <<Courses>>}{code-api-example-courses-1}

\addimghere{images/code/code-api-example-courses-2.png}{0.8}{Обработка метода GET к таблице <<Courses>> с переданным значением идентификатора}{code-api-example-courses-2}

Дальнейшие демонстрации кода также отображают составные элементы реализации разбора обращения.
На рисунке \ref{code-api-example-courses-3} -- обработка POST с передачей параметров, на рисунке \ref{code-api-example-courses-4} -- обработка PUT для конкретной записи с переданными данными,
на рисунке \ref{code-api-example-courses-5} -- обработка DELETE с переданным идентификатором.

\addimghere{images/code/code-api-example-courses-3.png}{1}{Обработка метода POST к таблице <<Courses>> с переданными в теле запроса данными для добавления новой записи}{code-api-example-courses-3}

\addimghere{images/code/code-api-example-courses-4.png}{1}{Обработка метода PUT к таблице <<Courses>> с переданным значением идентификатора и новыми данными в теле запроса}{code-api-example-courses-4}

Для обработки PUT и POST, как видно по представленным рисункам \ref{code-api-example-courses-3} и \ref{code-api-example-courses-4}, требуется дополнительно настроить обработку передаваемых в теле запроса параметров и их передача в запрос непосредственно к базе.
На данном этапе есть возможность добавить проверку передаваемых значений на соответствие типам и другим критериям, выдвигаемым к информации, но можно оставить разрешение данного вопроса на механизмы самой СУБД, что и было выбрано.

\addimghere{images/code/code-api-example-courses-5.png}{0.8}{Обработка метода DELETE к таблице <<Courses>> с переданным значением идентификатора}{code-api-example-courses-5}

Остальные запросы к оставшимся таблицам составляются аналогично с учетом изменения названия таблицы и её полей.
Технически возможно реализовать обращение сразу ко всем имеющимся таблицам через настройку одного метода, но такая реализация требует задействования дополнительных технологий или перехода на другую СУБД.

\subsection{Используемые программные интерфейсы взаимодействия с системой аутентификации}

Отдельно стоит вынести взаимодействие с таблицей <<Users>>, поскольку на нее возлагается ответственность аутентификации пользователя.
Для реализации данной системы потребуется задействовать некоторый способ ограничения доступа к части описанных запросов.

Например, GET методы, относящиеся к таблицам <<Courses>> или <<Students\_work>> относительно безобидны -- их выполнение выдаст информацию, аналогичную содержимому страницы.
Иная ситуация с запросами POST, PUT и DELETE -- их исполнение подразумевает изменение состояния исходных данных, что влияет на работу веб-сервиса.
Потому и необходимо разделение доступа для обычных пользователей и аутентифицированных администраторов сайта, которые могут отредактировать контент прямо в браузере.

Среди большого разнообразия технологий и подходов будет задействован один из простых -- Json Web Token \cite{jwt} -- стандарт создания токенов доступа на основе формата JSON \cite{wiki-json}. 


% // TODO использование passport, стратегий
% // TODO использование jwt
% // TODO применение в запросах редактирования

% // TODO реализация со стороны angular:
frontend/src/app/guards/content-editor.guard.ts

\subsection{Проверка работоспособности программных интерфейсов}
% // TODO Тесты исполнения запросов в POSTMAN

% // TODO Тесты автоматизированные?


\clearpage
